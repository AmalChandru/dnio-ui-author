<div class='p-3'>

    <div class="mb-2">
        <strong>State Model</strong>
    </div>

    <p class='text-secondary mb-4'>
        Per data service you will be able to select one attribute to configure a state model machine.
    </p>

    <section *ngIf="!stateModelEnabled" [formGroup]="form">
        <div class='d-flex justify-content-start'>
            <div id='select-state-model' formGroupName="stateModel" odpClickOutside (outside)='searchTerm = "" '>
                <input type="text" class="form-control" placeholder="Choose existing attribute or create one..." odpAutoFocus
                formControlName="attribute" (odpSearchTerm)="searchTerm = $event" >
            </div>
    
            <button type='button' id='configureStateModel' (click)='enableStateModel()'>
                Configure State Model
            </button>
        </div>
     
    
        <div class="selector-dropdown d-flex flex-column border rounded bg-white"
            *ngIf="searchTerm">
            <div class="selector-list">
                <div class="selector-list-item d-flex align-items-center p-2 hover"
                *ngFor="let def of (ListOfValuesAttributes| filterDefinition:searchTerm)" (click)="addExistingListOfValues(def.properties.name)">
                    <odp-field-type [field]="def"></odp-field-type>
                    <span class="ml-2">{{def.properties.name}}</span>
                </div>
    
                <div class="selector-list-item d-flex align-items-center p-2 hover"
                *ngIf="(ListOfValuesAttributes| filterDefinition:searchTerm).length == 0" (click)="addNewListOfValues('String')">
                    <odp-field-type [field]="{type:'String',properties:{}}"></odp-field-type>
                    <span class="ml-2">{{searchTerm}}</span>
                </div>
                <div class="selector-list-item d-flex align-items-center p-2 hover"
                *ngIf="(ListOfValuesAttributes| filterDefinition:searchTerm).length == 0" (click)="addNewListOfValues('Number')">
                    <odp-field-type [field]="{type:'Number',properties:{}}"></odp-field-type>
                    <span class="ml-2">{{searchTerm}}</span>
                </div>
    
            </div>
            <!-- <div class="selector-list">
              
            </div> -->
        </div>

        <div class='meme position-absolute text-center'>
            <img src="/assets/img/state_model_meme.png" alt="Meme" >
            <h4>
                Hmm...That box must be important...
            </h4>
        </div>


    </section>

    <section *ngIf="stateModelEnabled">

        <div class="d-flex justify-content-between">
            <div>
                {{stateModelAttribute}}
            </div>
            <div>
                <span (click)="disableStateModel()" id='deleteStateModel'>
                    Delete State Model 
                </span>
            </div>
        </div>
       
        <div class='mt-3 p-3 bg-white'>
        
            <div class ='new-state-section d-flex justify-content-start'>
                <div class='w-50'>
                    <input #newStateBox type="text" class="form-control" placeholder="Add State Value here" >
                </div>
        
                <div id='add-state' (click)='addNewState(newStateBox.value); newStateBox.value=null;'>
                    <span class="fa fa-plus"></span>
                </div>
            </div>
        

            <div class='mt-3'>
                <div class='row mb-3'>
                    <div class='col-3'>
                        <span class='state-model-label font-weight-bold'>State</span>
                    </div>
                    <div class='col-9'>
                        <span class='state-model-label font-weight-bold'>Add Next State</span>
                    </div>
                </div>

                <div class='state-model-config'>
                    <div class='row mb-3' *ngFor='let state of allStates'>
                        <div class='col-3'>
                            <span>{{state}}</span>
                        </div>
                        <div class='col-9'>
                            
                            <mat-form-field class="example-chip-list w-100" appearance="fill">
                                <mat-chip-list #chipList aria-label="Next State selection">
                                  <mat-chip *ngFor="let nextState of nextStates(state)" [selectable]="selectable"
                                           [removable]="removable" (removed)="remove(nextState, state)">
                                        {{nextState}}
                                    <mat-icon matChipRemove *ngIf="removable">
                                        <span class='fa fa-times'></span>
                                    </mat-icon>
                                  </mat-chip>
                                  <input placeholder="Next State..."
                                         #chipInput
                                         [matChipInputFor]="chipList"
                                         [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                         [matChipInputAddOnBlur]="addOnBlur"
                                         (matChipInputTokenEnd)="addNew($event, state , chipInput)">
                                </mat-chip-list>

                                <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="add($event, state , chipInput)">
                                    <mat-option *ngFor="let tag of allStates" [value]="state">
                                      <span>{{ state }}</span>
                                    </mat-option>
                                </mat-autocomplete>

                              </mat-form-field>
                        </div>
                    </div>
                
                </div>
            </div>

        </div>

    </section>


    <!-- <div class='mt-3 p-3 bg-white'>

        <div class='w-50'>
            <input type="text" class="form-control" placeholder="Add State Value here">
        </div>

        <div class='mt-3'>
            <div class='row mb-3'>
                <div class='col-3'>
                    <span class='state-model-label font-weight-bold'>State</span>
                </div>
                <div class='col-9'>
                    <span class='state-model-label font-weight-bold'>Add Next State</span>
                </div>
            </div>

            <div class='state-model-config'>
                <div class='row mb-3'>
                    <div class='col-3'>
                        <span>Open</span>
                    </div>
                    <div class='col-9'>
                        <mat-form-field class="example-chip-list w-100" appearance="fill">
                            <mat-label>Favorite Fruits</mat-label>
                            <mat-chip-list #chipList aria-label="Fruit selection">
                              <mat-chip
                                *ngFor="let fruit of fruits"
                                [selectable]="selectable"
                                [removable]="removable"
                                (removed)="remove(fruit)">
                                {{fruit}}
                                <mat-icon matChipRemove *ngIf="removable">x</mat-icon>
                              </mat-chip>
                              <input
                                placeholder="New fruit..."
                                #fruitInput
                                [formControl]="fruitCtrl"
                                [matAutocomplete]="auto"
                                [matChipInputFor]="chipList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                (matChipInputTokenEnd)="add($event)">
                            </mat-chip-list>
                            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                              <mat-option *ngFor="let fruit of filteredFruits | async" [value]="fruit">
                                {{fruit}}
                              </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                </div>
                <div class='row'>
                    <div class='col-3'>
                        <span>Close</span>
                    </div>
                    <div class='col-9'>
                        <span>Close</span>
                    </div>
                </div>
            </div>
        </div>

    </div> -->




</div>