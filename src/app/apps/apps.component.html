<div class="d-flex flex-column w-100 h-100">
  <div class="header d-flex align-items-center justify-content-between w-100 p-3 bg-white border-bottom border-dark">
    <div class="left d-flex align-items-center" [ngClass]="{ 'add-blur': addBlur }"
      [ngStyle]="{ width: showSideNav ? '15vw' : '4vw' }">
      <!-- <span class="fa fa-bars fa-lg hover mr-3" (click)="toggleNav()"></span> -->
      <div *ngIf="showSideNav" class="logo" (click)="toggleNav()"></div>
      <div *ngIf="!showSideNav" class="logo-mini" (click)="toggleNav()"></div>
    </div>
    <div style="flex: 1 0 0">
      <odp-breadcrumb [paths]="breadcrumbPaths"></odp-breadcrumb>
    </div>
    <div class="w-50 d-flex align-items-center justify-content-end">
      <ng-container *ngIf="isSuperAdmin">
        <!-- <div class="d-flex align-items-center mr-3">
                    <button type="button" class="btn btn-link font-sm" (click)="downloadIEG()">
                        <span class="dsi dsi-download"></span>
                        <span class="ml-2">Edge Agent</span>
                    </button>
                </div> -->
        <div (click)="loadAdminPage()"
          class="admin-settings bg-light rounded d-flex flex-column justify-content-center align-items-center mr-3 hover"
          ngbTooltip="Admin Panel" placement="bottom">
          <odp-admin-console-icon size="28"></odp-admin-console-icon>
        </div>
      </ng-container>
      <div class="current-app d-flex align-items-center border rounded mr-3 hover ignore-outside"
        (click)="toggleAppOptions()">
        <div class="current-app-thumbnail d-flex align-items-center justify-content-center mx-2" ngbTooltip="Switch App"
          placement="bottom" [ngStyle]="{ 'background-color': selectedApp.bg }" [ngClass]="{
            'img-app': selectedApp.logo && selectedApp.logo.thumbnail
          }">
          <img *ngIf="selectedApp.logo && selectedApp.logo.thumbnail" [src]="selectedApp.logo.thumbnail" alt="Logo" />
          <span *ngIf="!selectedApp.logo || !selectedApp.logo.thumbnail">{{selectedApp.firstLetter}}</span>
        </div>
        <div class="current-app-name text-dark text-truncate" ngbTooltip="Current App" placement="bottom">
          {{ selectedApp._id }}
        </div>
        <div class="text-primary"></div>
        <div *ngIf="isAppAdmin" class="d-flex align-items-center justify-content-center ml-1">
          <span class="fa fa-star text-warning" ngbTooltip="You are admin of this App" placement="bottom"></span>
        </div>
        <div *ngIf="commonService.appList.length > 1" class="ml-auto mr-2">
          <span class="fas fa-angle-down text-accent"></span>
        </div>
      </div>
      <div
        class="profile-icon position-relative d-flex align-items-center justify-content-center rounded-circle bg-light border border-border hover"
        (click)="showProfileOptions = !showProfileOptions">
        <span class="far fa-user fa-lg text-secondary"></span>
      </div>
      <div [@userProfile] class="profile position-absolute bg-white border border-border" *ngIf="showProfileOptions"
        odpClickOutside [ignore]="['.profile-icon', '.fa-user']" (outside)="showProfileOptions = false">
        <div class="profile-container position-relative d-flex align-items-center h-100 w-100">
          <div
            class="profile-thumbnail d-flex align-items-center justify-content-center rounded-circle bg-light border border-border mx-4">
            <span class="far fa-user fa-2x text-secondary"></span>
          </div>
          <div class="profile-data d-flex flex-column">
            <h4 class="profile-data-name text-truncate font-weight-bold">
              {{ name }}
            </h4>
            <div class="profile-data-more d-flex align-items-center">
              <div class="text-secondary profile-data-more-item pr-3 username-holder text-truncate"
                [ngbTooltip]="username">
                {{ username }}
              </div>
              <div class="profile-data-more-item px-1" *ngIf="authType && authType === 'local'">
                <button type="button" class="btn btn-link btn-sm" (click)="
                    showProfileOptions = false; toggleChangePassword = true
                  ">
                  Change Password
                </button>
              </div>
              <div class="profile-data-more-item px-1">
                <button type="button" class="btn btn-link btn-sm" (click)="logout()" id="logout">
                  Logout
                </button>
              </div>
            </div>
          </div>
          <small class="position-absolute text-border app-version">v{{ version }}</small>
          <small class="last-login text-muted">Last Login:
            {{
            lastLogin | dateFormat: 'YYYY MMM DD, HH:mm:ss, z':'Etc/Zulu'
            }}</small>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex w-100 h-100">
    <div class="sidenav d-flex flex-column pl-3" id="_sideNavBar" [ngStyle]="{ width: showSideNav ? '260px' : '48px' }">
      <div class="icon-block-group text-secondary border-border pt-3 mb-2"
        *ngIf="hasDataServicePermission || hasDataLibraryPermission">
        <span *ngIf="showSideNav">DATA</span>
        <div *ngIf="showSideNav" class="dsi" [ngClass]="{
            'dsi-drop-down': openPanel['data'],
            'dsi-drop-up': !openPanel['data']
          }" (click)="togglePanel('data')"></div>
      </div>
      <div *ngIf="openPanel['data']">
        <div *ngIf="hasDataServicePermission" #serviceRoute="routerLinkActive"
          class="icon-block d-flex align-items-center my-3"
          [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
          routerLinkActive="text-accent bg-white active" [routerLink]="['sm']" id="_entities" (click)="getBreadcrumbs()"
          Data>
          <div class="d-flex align-items-center">
            <span class="dsi dsi-data-service"></span>
            <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                'font-weight': serviceRoute.isActive ? 700 : 500,
                color: serviceRoute.isActive ? '#181818' : '#7A7A7A'
              }">Services</span>
          </div>
        </div>
        <div *ngIf="hasDataLibraryPermission" #libraryRoute="routerLinkActive"
          class="icon-block d-flex align-items-center my-3"
          [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
          routerLinkActive="text-accent bg-white active" [routerLink]="['lib']" id="_lib">
          <div class="d-flex align-items-center">
            <span class="dsi dsi-library"></span>
            <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                'font-weight': libraryRoute.isActive ? 700 : 500,
                color: libraryRoute.isActive ? '#181818' : '#7A7A7A'
              }">Library</span>
          </div>
        </div>
        <div *ngIf="hasFunctionsPermission" #functionRoute="routerLinkActive"
          class="icon-block d-flex align-items-center my-3"
          [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
          routerLinkActive="text-accent bg-white active" [routerLink]="['faas']" id="function">
          <div class="d-flex align-items-center">
            <span class="dsi dsi-function"></span>
            <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                'font-weight': functionRoute.isActive ? 700 : 500,
                color: functionRoute.isActive ? '#181818' : '#7A7A7A'
              }">Functions</span>
          </div>
        </div>
      </div>

      <ng-container>
        <div class="icon-block-group text-secondary border-top border-border border-c pt-2 mt-1 mb-2" *ngIf="
            hasPermission('PMDS') ||
            hasPermission('PVDS') ||
            hasPermission('PML') ||
            hasPermission('PVL')
          ">
          <span *ngIf="showSideNav">INTEGRATION</span>
          <div *ngIf="showSideNav" class="dsi" [ngClass]="{
              'dsi-drop-down': openPanel['integration'],
              'dsi-drop-up': !openPanel['integration']
            }" (click)="togglePanel('integration')"></div>
        </div>
        <!-- <div *ngIf="hasPartnerPermission" #partnerRoute="routerLinkActive"
                    class="icon-block d-flex align-items-center my-3" [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
                    routerLinkActive="text-accent bg-white active" [routerLink]="['pm']" id="partnerManager"
                    (mouseover)="hover.partner = true" (mouseleave)="hover.partner = false">
                    <div class="d-flex align-items-center">
                        <span class="dsi dsi-partner"></span>
                        <span class="text" [ngClass]="{'text-accent':hover.partner}">Partners</span>
                    </div>
                    <span *ngIf="partnerRoute.isActive" class="fa fa-angle-right mr-3"></span>
                </div> -->
        <div *ngIf="openPanel['integration']">
          <div #flowRoute="routerLinkActive" class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['flow']" id="flowManager">
            <div class="d-flex align-items-center">
              <span class="dsi dsi-flow"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': flowRoute.isActive ? 700 : 500,
                  color: flowRoute.isActive ? '#181818' : '#7A7A7A'
                }">Flows</span>
            </div>
          </div>
          <div *ngIf="hasDataFormatPermission" #dataFormatRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['dfl']" id="dataFormat">
            <div class="d-flex align-items-center">
              <span class="dsi dsi-library"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': dataFormatRoute.isActive ? 700 : 500,
                  color: dataFormatRoute.isActive ? '#181818' : '#7A7A7A'
                }">Data Formats</span>
            </div>
          </div>
          <div *ngIf="hasAgentsPermission" #agentRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['agent']" id="agent">
            <div class="d-flex align-items-center">
              <span class="dsi dsi-agent"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': agentRoute.isActive ? 700 : 500,
                  color: agentRoute.isActive ? '#181818' : '#7A7A7A'
                }">Agents</span>
            </div>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="
          hasGroupsPermission ||
          hasUsersPermission ||
          hasBotPermission ||
          hasBookmarkPermission ||
          hasInsightsPermission
        ">
        <div class="icon-block-group text-secondary border-top border-border border-c pt-3 mt-1">
          <span *ngIf="showSideNav">MANAGEMENT</span>
          <div *ngIf="showSideNav" class="dsi" [ngClass]="{
              'dsi-drop-down': openPanel['management'],
              'dsi-drop-up': !openPanel['management']
            }" (click)="togglePanel('management')"></div>
        </div>
        <div *ngIf="openPanel['management']">
          <div *ngIf="isAppAdmin || isSuperAdmin" #appRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['app']" id="apps">
            <div class="d-flex align-items-center">
              <span class="dsi dsi-app-panel"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': appRoute.isActive ? 700 : 500,
                  color: appRoute.isActive ? '#181818' : '#7A7A7A'
                }">App Panel
              </span>
            </div>
          </div>
          <!--<div *ngIf="isAppAdmin || isSuperAdmin" #wfRoute="routerLinkActive"
                   class="icon-block d-flex align-items-center my-3" [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
                   routerLinkActive="text-accent bg-white active" [routerLink]="['cp/workflow']" id="wfs"
                   (mouseover)="hover.wfs = true" (mouseleave)="hover.wfs = false">
                  <div class="d-flex align-items-center">
                      <span class="dsi dsi-data-service"></span>
                      <span class="text ml-1" [ngClass]="{'text-accent':hover.wfs}">Workitems</span>
                  </div>
                  <span *ngIf="wfRoute.isActive" class="fa fa-angle-right mr-3"></span>
              </div>-->
          <!-- <div *ngIf="hasBookmarkPermission" #bookmarkRoute="routerLinkActive"
                  class="icon-block d-flex align-items-center my-3" [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
                  routerLinkActive="text-accent bg-white active" [routerLink]="['cp/bookmarks']" id="bookmark"
                  (mouseover)="hover.bookmark = true" (mouseleave)="hover.bookmark = false">
                  <div class="d-flex align-items-center ml-1">
                     <span class="dsi dsi-bookmark"></span>
                      <span class="text" [ngClass]="{'text-accent':hover.bookmark}">Bookmarks</span>
                  </div>
                  <span *ngIf="bookmarkRoute.isActive" class="fa fa-angle-right mr-3"></span>
              </div> -->
          <div *ngIf="hasUsersPermission" #userRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['cp/user']" id="_usersMng">
            <div class="d-flex align-items-center ml-1">
              <span class="dsi dsi-user"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': userRoute.isActive ? 700 : 500,
                  color: userRoute.isActive ? '#181818' : '#7A7A7A'
                }">Users</span>
            </div>
          </div>
          <div *ngIf="hasBotPermission && authType == 'azure'" #botRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['bots']">
            <div class="d-flex align-items-center ml-1">
              <span class="dsi dsi-bot"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': botRoute.isActive ? 700 : 500,
                  color: botRoute.isActive ? '#181818' : '#7A7A7A'
                }">Bots</span>
            </div>
          </div>
          <div *ngIf="hasBotPermission && authType != 'azure'" #botRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['local-bots']">
            <div class="d-flex align-items-center ml-1">
              <span class="dsi dsi-bot"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': botRoute.isActive ? 700 : 500,
                  color: botRoute.isActive ? '#181818' : '#7A7A7A'
                }">Bots</span>
            </div>
          </div>
          <div *ngIf="hasGroupsPermission" #groupRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['cp/gr']" id="_groups">
            <div class="d-flex align-items-center ml-1">
              <span class="dsi dsi-object"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': groupRoute.isActive ? 700 : 500,
                  color: groupRoute.isActive ? '#181818' : '#7A7A7A'
                }">Groups</span>
            </div>
          </div>
          <div *ngIf="hasInsightsPermission" #insightRoute="routerLinkActive"
            class="icon-block d-flex align-items-center my-3"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            routerLinkActive="text-accent bg-white active" [routerLink]="['insight']" id="insights">
            <div class="d-flex align-items-center ml-1">
              <span class="dsi dsi-insight"></span>
              <span *ngIf="showSideNav" class="text items" [ngStyle]="{
                  'font-weight': insightRoute.isActive ? 700 : 500,
                  color: insightRoute.isActive ? '#181818' : '#7A7A7A'
                }">Insights</span>
            </div>
          </div>
          <div *ngIf="hasDataServicePermission" class="icon-block d-flex align-items-center my-3" id="apis"
            [ngClass]="{'justify-content-between':showSideNav, 'justify-content-center':!showSideNav}"
            (click)="openAPIsWindow()">
            <div class="d-flex align-items-center ml-1">
              <span class="dsi dsi-api-doc"></span>
              <span *ngIf="showSideNav" class="text items">APIs</span>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    <div class="d-flex flex-column body w-100">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>

<odp-app-switcher *ngIf="showAppOptions" [activeApp]="selectedApp" (activeAppChange)="onAppChange($event)"
  (cancel)="showAppOptions = false"></odp-app-switcher>

<odp-change-password *ngIf="toggleChangePassword" [(toggleModal)]="toggleChangePassword"></odp-change-password>

<ng-template #downloadAgentModalTemplate>
  <div class="modal-body p-4 d-flex flex-column align-items-center">
    <p class="text-dark font-weight-bold text-center mt-3">
      Choose Architecture
    </p>
    <select id="arch" class="custom-select agent-arch-select" [(ngModel)]="agentConfig.arch">
      <option value="amd64">64-bit</option>
      <option value="386">32-bit</option>
    </select>
    <p class="text-dark font-weight-bold text-center mt-3">
      Choose your platform
    </p>
    <div class="d-flex my-3">
      <div class="d-flex flex-column">
        <div class="d-flex align-items-center justify-content-center">
          <div
            class="d-flex flex-column align-items-center justify-content-center platform rounded border m-3 hover border-primary"
            (click)="downloadAgentModalTemplateRef.close('windows')">
            <span class="fab fa-windows fa-2x"></span>
            <span class="text mt-3">Windows</span>
          </div>
          <div *ngIf="agentConfig.arch != '386'"
            class="d-flex flex-column align-items-center justify-content-center platform rounded border m-3 hover border-primary"
            (click)="downloadAgentModalTemplateRef.close('darwin')">
            <span class="fab fa-apple fa-2x"></span>
            <span class="text mt-3">Mac OS</span>
          </div>
          <div
            class="d-flex flex-column align-items-center justify-content-center platform rounded border m-3 hover border-primary"
            (click)="downloadAgentModalTemplateRef.close('linux')">
            <span class="fab fa-linux fa-2x"></span>
            <span class="text mt-3">Linux</span>
          </div>
        </div>
      </div>
      <div class="d-flex flex-column align-self-stretch align-items-center">
        <span class="border-right h-100"></span>
        <span class="text-secondary mx-2">OR</span>
        <span class="border-right h-100"></span>
      </div>
      <div class="d-flex align-items-center justify-content-center">
        <div
          class="d-flex flex-column align-items-center justify-content-center platform rounded border m-3 hover border-primary"
          (click)="downloadAgentModalTemplateRef.close('k8s')">
          <span class="k8s-icon"></span>
          <span class="text mt-3">Kubernetes</span>
        </div>
      </div>
    </div>
    <div class="d-flex align-items-center w-100 px-4 font-sm">
      <span class="text-secondary ml-2">Password</span>
      <div class="d-flex align-items-center justify-content-center mx-3">
        <span *ngIf="!agentConfig.showPassword" class="dsi dsi-view mr-2"
          (click)="agentConfig.showPassword = true; getAgentPassword()"></span>
        <span *ngIf="agentConfig.showPassword" class="dsi dsi-hide mr-2"
          (click)="agentConfig.showPassword = false"></span>
        <span *ngIf="!agentConfig.showPassword" class="text-dark">******</span>
        <span *ngIf="agentConfig.showPassword" class="text-dark d-flex align-items-center">
          <span *ngIf="!agentConfig.password" class="fa fa-spinner fa-pulse"></span>
          <span *ngIf="agentConfig.password">{{ agentConfig.password }}</span>
          <span class="fa fa-copy ml-2 hover" (click)="copyPassword()"></span>
        </span>
      </div>
      <div class="d-flex align-items-center justify-content-center">
        <span *ngIf="agentConfig.copied" class="text-info">Password Copied!</span>&nbsp;
      </div>
    </div>
    <div class="d-flex align-self-end">
      <button type="button" class="btn btn-link" id="deletePartnerModalNo"
        (click)="downloadAgentModalTemplateRef.close(false)">
        Close
      </button>
    </div>
  </div>
</ng-template>